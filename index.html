<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CodeChat Forum</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="style.css">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js"></script>
</head>

<body>
<header>
  <div class="logo">ðŸ”¥ CodeChat Forum</div>
  <div class="user-panel">
    <img id="user-profile-pic" alt="Profile Picture">
    <span id="user-name"></span>
    <button onclick="logout()">Log Out</button>
  </div>
</header>

<main>
  <section id="ask-question">
    <textarea id="question-input" placeholder="What do you want to ask?"></textarea>
    <button onclick="postQuestion()">Post Question</button>
  </section>

  <section id="questions-feed"></section>
</main>

<script src="firebase.js"></script>
<script>
  firebase.auth().onAuthStateChanged(user => {
    if (user) {
      const userDoc = firebase.firestore().collection('users').doc(user.uid);
      userDoc.get().then(doc => {
        const data = doc.data();
        document.getElementById('user-name').textContent = data.fullName;
        document.getElementById('user-profile-pic').src = data.profilePicture;
      });

      loadQuestions();
    } else {
      window.location.href = 'login.html';
    }
  });

  function postQuestion() {
    const questionText = document.getElementById('question-input').value;
    if (questionText) {
      const user = firebase.auth().currentUser;
      firebase.firestore().collection('questions').add({
        question: questionText,
        userId: user.uid,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      document.getElementById('question-input').value = '';
    }
  }

  function loadQuestions() {
    const feed = document.getElementById('questions-feed');
    firebase.firestore().collection('questions').orderBy('timestamp', 'desc').onSnapshot(snapshot => {
      feed.innerHTML = '';
      snapshot.forEach(doc => {
        const data = doc.data();
        const questionCard = document.createElement('div');
        questionCard.className = 'question-card';
        questionCard.innerHTML = `
          <p>${data.question}</p>
          <button onclick="answerQuestion('${doc.id}')">Answer</button>
          <div id="answers-${doc.id}" class="answers-section"></div>
        `;
        feed.appendChild(questionCard);

        loadAnswers(doc.id);
      });
    });
  }

  function answerQuestion(questionId) {
    const answer = prompt('Enter your answer:');
    if (answer) {
      const user = firebase.auth().currentUser;
      firebase.firestore().collection('questions').doc(questionId).collection('answers').add({
        answer: answer,
        userId: user.uid,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
    }
  }

  function loadAnswers(questionId) {
    const answersDiv = document.getElementById(`answers-${questionId}`);
    firebase.firestore().collection('questions').doc(questionId).collection('answers').orderBy('timestamp')
      .onSnapshot(snapshot => {
        answersDiv.innerHTML = '';
        snapshot.forEach(doc => {
          const data = doc.data();
          const answerElem = document.createElement('p');
          answerElem.textContent = `Answer: ${data.answer}`;
          answersDiv.appendChild(answerElem);
        });
      });
  }

  function logout() {
    firebase.auth().signOut().then(() => window.location.href = 'login.html');
  }
</script>

</body>
</html>
